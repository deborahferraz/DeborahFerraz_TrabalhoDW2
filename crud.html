<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel do Gerente - Pixel Peach</title>
  <link rel="stylesheet" href="assets/css/lojinha.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .header-admin {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .header-admin h1 {
      color: white;
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .header-admin .subtitle {
      text-align: center;
      color: rgba(255, 255, 255, 0.8);
      font-size: 1.1rem;
    }

    .back-btn {
      position: absolute;
      top: 30px;
      left: 30px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .form-section {
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 20px;
      margin-bottom: 30px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }

    .form-section h2 {
      color: #333;
      margin-bottom: 25px;
      font-size: 1.8rem;
      text-align: center;
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-weight: 500;
      color: #555;
      margin-bottom: 8px;
    }

    input, select, button {
      padding: 12px 15px;
      border: 2px solid #e1e8ed;
      border-radius: 12px;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 20px;
      height: 20px;
    }

    .img-preview {
      max-height: 120px;
      border-radius: 12px;
      margin-top: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .btn-primary {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .products-section {
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }

    .products-section h2 {
      color: #333;
      margin-bottom: 30px;
      font-size: 1.8rem;
      text-align: center;
      background: linear-gradient(45deg, #764ba2, #667eea);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .category-section {
      margin-bottom: 40px;
    }

    .category-header {
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white;
      padding: 15px 25px;
      border-radius: 15px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }

    .category-header h3 {
      font-size: 1.3rem;
      font-weight: 600;
    }

    .category-count {
      background: rgba(255, 255, 255, 0.2);
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .product-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.15);
      border-color: #667eea;
    }

    .product-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 15px;
    }

    .product-info h4 {
      color: #333;
      font-size: 1.1rem;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .product-price {
      color: #667eea;
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .product-promo {
      display: inline-block;
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      margin-bottom: 15px;
    }

    .product-actions {
      display: flex;
      gap: 10px;
    }

    .btn-edit {
      background: linear-gradient(45deg, #74b9ff, #0984e3);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.3s ease;
      flex: 1;
    }

    .btn-edit:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(116, 185, 255, 0.4);
    }

    .btn-delete {
      background: linear-gradient(45deg, #ff7675, #d63031);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.3s ease;
      flex: 1;
    }

    .btn-delete:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 118, 117, 0.4);
    }

    .empty-category {
      text-align: center;
      color: #888;
      font-style: italic;
      padding: 40px;
      background: #f8f9fa;
      border-radius: 12px;
      border: 2px dashed #ddd;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: white;
      margin-bottom: 5px;
    }

    .stat-label {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .products-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Voltar</button>

  <div class="admin-container">
    <div class="header-admin">
      <h1>üõ†Ô∏è Painel do Gerente</h1>
      <p class="subtitle">Gerencie seus produtos com facilidade</p>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="totalProducts">0</div>
        <div class="stat-label">Total de Produtos</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="promoProducts">0</div>
        <div class="stat-label">Em Promo√ß√£o</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="totalCategories">5</div>
        <div class="stat-label">Categorias</div>
      </div>
    </div>

    <div class="form-section">
      <h2>‚ú® Adicionar/Editar Produto</h2>
      <form id="productForm">
        <input type="hidden" id="editId">
        
        <div class="form-grid">
          <div class="form-group">
            <label for="name">Nome do Produto</label>
            <input type="text" id="name" placeholder="Ex: Camiseta B√°sica" required>
          </div>
          
          <div class="form-group">
            <label for="price">Pre√ßo (R$)</label>
            <input type="number" id="price" placeholder="0.00" step="0.01" required>
          </div>
          
          <div class="form-group">
            <label for="category">Categoria</label>
            <select id="category" required>
              <option value="">Escolha a categoria</option>
              <option value="blusas">üëö Blusas</option>
              <option value="calcas">üëñ Cal√ßas</option>
              <option value="saias">üëó Saias</option>
              <option value="vestidos">üíÉ Vestidos</option>
              <option value="acessorios">üíé Acess√≥rios</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="imgInput">Imagem do Produto</label>
            <input type="file" id="imgInput" accept="image/*">
            <img id="imgPreview" src="" alt="Preview" class="img-preview" style="display:none;">
          </div>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="promo">
          <label for="promo">üî• Produto em promo√ß√£o</label>
        </div>
        
        <button type="submit" class="btn-primary">üíæ Salvar Produto</button>
      </form>
    </div>

    <div class="products-section">
      <h2>üì¶ Produtos por Categoria</h2>
      <div id="categoriesContainer"></div>
    </div>
  </div>

  <script>
    // Verificar se √© gerente
    const user = JSON.parse(localStorage.getItem("currentUser"));
    if (!user || user.role !== "gerente") {
      alert("Acesso restrito ao gerente.");
      window.location.href = "index.html";
    }

    // Produtos base + produtos adicionados pelo admin
    const baseProducts = [
      { id: 1, name: "Camiseta Preta", category: "blusas", price: 59.90, promo: true, img: "./assets/imagens/CamisetaPreta.png" },
      { id: 2, name: "Cal√ßa Jeans", category: "calcas", price: 89.90, promo: true, img: "./assets/imagens/Cal√ßaJeans.png" },
      { id: 3, name: "Jaqueta de Couro", category: "blusas", price: 149.90, promo: false, img: "./assets/imagens/JaquetaCouro.png" },
      { id: 4, name: "Vestido Floral", category: "vestidos", price: 79.90, promo: true, img: "./assets/imagens/VestidoFloral.png" },
      { id: 5, name: "Saia Plissada", category: "saias", price: 69.90, promo: false, img: "./assets/imagens/SaiaPlissada.png" },
      { id: 6, name: "Colar de Cora√ß√£o", category: "acessorios", price: 29.90, promo: false, img: "./assets/imagens/ColarCoracao.png" },
      { id: 7, name: "Brinco de P√©rola", category: "acessorios", price: 19.90, promo: false, img: "./assets/imagens/BrincoPerola.png" },
      { id: 8, name: "Macac√£o Jeans", category: "calcas", price: 129.90, promo: false, img: "./assets/imagens/MacacaoJeans.png" },
      { id: 9, name: "Top Canelado", category: "blusas", price: 39.90, promo: false, img: "./assets/imagens/Cropped.png" },
      { id: 10, name: "Vestido Longo", category: "vestidos", price: 99.90, promo: false, img: "./assets/imagens/VestidoLongo.png" }
    ];

    let allProducts = [...baseProducts];
    const adminProducts = JSON.parse(localStorage.getItem("adminProducts")) || [];
    
    // Adicionar produtos do admin com IDs √∫nicos
    adminProducts.forEach(product => {
      const maxId = Math.max(...allProducts.map(p => p.id), 0);
      allProducts.push({ ...product, id: maxId + 1 });
    });

    const imgInput = document.getElementById("imgInput");
    const imgPreview = document.getElementById("imgPreview");

    // Preview da imagem
    imgInput.addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          imgPreview.src = e.target.result;
          imgPreview.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    function saveProducts() {
      // Salvar apenas os produtos adicionados pelo admin
      const adminOnlyProducts = allProducts.filter(p => p.id > 10);
      localStorage.setItem("adminProducts", JSON.stringify(adminOnlyProducts));
    }

    function updateStats() {
      const totalProducts = allProducts.length;
      const promoProducts = allProducts.filter(p => p.promo).length;
      
      document.getElementById("totalProducts").textContent = totalProducts;
      document.getElementById("promoProducts").textContent = promoProducts;
    }

    function renderProductsByCategory() {
      const categories = {
        'blusas': { name: 'üëö Blusas', products: [] },
        'calcas': { name: 'üëñ Cal√ßas', products: [] },
        'saias': { name: 'üëó Saias', products: [] },
        'vestidos': { name: 'üíÉ Vestidos', products: [] },
        'acessorios': { name: 'üíé Acess√≥rios', products: [] }
      };

      // Organizar produtos por categoria
      allProducts.forEach(product => {
        if (categories[product.category]) {
          categories[product.category].products.push(product);
        }
      });

      const container = document.getElementById("categoriesContainer");
      container.innerHTML = "";

      Object.keys(categories).forEach(categoryKey => {
        const category = categories[categoryKey];
        const categoryDiv = document.createElement("div");
        categoryDiv.className = "category-section";

        const categoryHeader = document.createElement("div");
        categoryHeader.className = "category-header";
        categoryHeader.innerHTML = `
          <h3>${category.name}</h3>
          <div class="category-count">${category.products.length} produtos</div>
        `;

        const productsGrid = document.createElement("div");
        productsGrid.className = "products-grid";

        if (category.products.length === 0) {
          productsGrid.innerHTML = `
            <div class="empty-category">
              Nenhum produto nesta categoria ainda
            </div>
          `;
        } else {
          category.products.forEach(product => {
            const productCard = document.createElement("div");
            productCard.className = "product-card";
            productCard.innerHTML = `
              <img src="${product.img}" alt="${product.name}" class="product-image" onerror="this.src='https://via.placeholder.com/300x150?text=Sem+Imagem'">
              <div class="product-info">
                <h4>${product.name}</h4>
                <div class="product-price">R$ ${parseFloat(product.price).toFixed(2)}</div>
                ${product.promo ? '<span class="product-promo">üî• Em Promo√ß√£o</span>' : ''}
                <div class="product-actions">
                  <button class="btn-edit" onclick="editProduct(${product.id})">‚úèÔ∏è Editar</button>
                  <button class="btn-delete" onclick="deleteProduct(${product.id})">üóëÔ∏è Excluir</button>
                </div>
              </div>
            `;
            productsGrid.appendChild(productCard);
          });
        }

        categoryDiv.appendChild(categoryHeader);
        categoryDiv.appendChild(productsGrid);
        container.appendChild(categoryDiv);
      });
    }

    function editProduct(id) {
      const product = allProducts.find(p => p.id === id);
      if (!product) return;

      document.getElementById("editId").value = id;
      document.getElementById("name").value = product.name;
      document.getElementById("price").value = product.price;
      document.getElementById("category").value = product.category;
      document.getElementById("promo").checked = product.promo;
      
      if (product.img) {
        imgPreview.src = product.img;
        imgPreview.style.display = "block";
      }

      // Scroll para o formul√°rio
      document.querySelector(".form-section").scrollIntoView({ behavior: 'smooth' });
    }

    function deleteProduct(id) {
      const product = allProducts.find(p => p.id === id);
      if (!product) return;

      if (confirm(`Tem certeza que deseja excluir "${product.name}"?`)) {
        allProducts = allProducts.filter(p => p.id !== id);
        saveProducts();
        renderProductsByCategory();
        updateStats();
      }
    }

    // Formul√°rio de produtos
    document.getElementById("productForm").addEventListener("submit", function(e) {
      e.preventDefault();
      
      const id = document.getElementById("editId").value;
      const name = document.getElementById("name").value.trim();
      const price = parseFloat(document.getElementById("price").value);
      const category = document.getElementById("category").value;
      const promo = document.getElementById("promo").checked;
      const img = imgPreview.src || "https://via.placeholder.com/300x150?text=Sem+Imagem";

      if (!name || !price || !category) {
        alert("Preencha todos os campos obrigat√≥rios!");
        return;
      }

      const product = { name, price, category, img, promo };

      if (id === "") {
        // Novo produto
        const maxId = Math.max(...allProducts.map(p => p.id), 0);
        product.id = maxId + 1;
        allProducts.push(product);
      } else {
        // Editar produto existente
        const index = allProducts.findIndex(p => p.id == id);
        if (index !== -1) {
          allProducts[index] = { ...product, id: parseInt(id) };
        }
      }

      saveProducts();
      renderProductsByCategory();
      updateStats();
      
      // Limpar formul√°rio
      this.reset();
      imgPreview.style.display = "none";
      document.getElementById("editId").value = "";
      
      alert(id === "" ? "Produto adicionado com sucesso!" : "Produto atualizado com sucesso!");
    });

    // Inicializar p√°gina
    renderProductsByCategory();
    updateStats();
  </script>
</body>
</html>
